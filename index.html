<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Repaso M√≥dulo 3 - Soporte de Vida</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #0b1020;
      --card: #151a2c;
      --accent: #ffb74d;
      --accent-soft: rgba(255, 183, 77, 0.2);
      --accent-2: #64b5f6;
      --danger: #ef5350;
      --success: #81c784;
      --text: #f5f5f5;
      --muted: #9ea7c5;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: radial-gradient(circle at top, #1b2450, #050713 65%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
    }

    .container {
      max-width: 900px;
      width: 100%;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 2.2rem;
    }

    h1 span {
      font-size: 1.2rem;
      display: block;
      color: var(--accent-2);
      margin-top: 5px;
    }

    .card {
      background: linear-gradient(145deg, rgba(255,255,255,0.02), rgba(255,255,255,0.03));
      border-radius: 18px;
      padding: 18px 18px 16px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(8px);
      margin-bottom: 18px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .row > * {
      flex: 1 1 200px;
    }

    label {
      font-size: 0.9rem;
      color: var(--muted);
    }

    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.18);
      background: #050713;
      color: var(--text);
      outline: none;
    }

    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .stat-pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .progress-bar {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      overflow: hidden;
      margin-top: 6px;
    }

    .progress-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width 0.3s ease;
    }

    .question-topic {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .question-text {
      font-size: 1.05rem;
      margin-bottom: 10px;
    }

    .options {
      display: grid;
      gap: 8px;
      margin-top: 4px;
      margin-bottom: 8px;
    }

    .option-btn {
      width: 100%;
      text-align: left;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      background: rgba(4,7,20,0.8);
      color: var(--text);
      cursor: pointer;
      font-size: 0.94rem;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.15s ease, background 0.15s ease;
    }

    .option-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.06);
    }

    .option-btn.selected {
      border-color: var(--accent-2);
      background: radial-gradient(circle at top left, rgba(100,181,246,0.25), rgba(4,7,20,0.9));
    }

    .option-btn.correct {
      border-color: var(--success);
      background: rgba(129,199,132,0.18);
    }

    .option-btn.incorrect {
      border-color: var(--danger);
      background: rgba(239,83,80,0.15);
    }

    .feedback {
      font-size: 0.92rem;
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 10px;
      background: rgba(0,0,0,0.3);
    }

    .feedback.correct {
      border-left: 3px solid var(--success);
    }

    .feedback.incorrect {
      border-left: 3px solid var(--danger);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    button.action {
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent-soft);
      color: var(--accent);
    }

    button.action.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: #050713;
      font-weight: 600;
    }

    button.action:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .mini {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 4px;
    }

    @media (max-width: 600px) {
      body {
        padding: 12px;
      }
      h1 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Juego de Repaso ‚Äì M√≥dulo 3
    <span>M√°quinas de anestesia, infusi√≥n, RRT, heart‚Äìlung & m√°s</span>
  </h1>

  <!-- Controles superiores -->
  <div class="card">
    <div class="row">
      <div>
        <label for="topicSelect">Tema</label>
        <select id="topicSelect">
          <option value="todos">Todos los temas (mixto)</option>
          <option value="Anestesia - B√°sico">Anestesia ‚Äì B√°sico</option>
          <option value="Anestesia - Componentes/Seguridad">Anestesia ‚Äì Componentes/Seguridad</option>
          <option value="Anestesia - Conversi√≥n a ventilador">Anestesia ‚Äì Conversi√≥n a ventilador</option>
          <option value="Infusi√≥n">Infusi√≥n</option>
          <option value="RRT/Hemodi√°lisis">RRT / Hemodi√°lisis / CRRT</option>
          <option value="RRT - Di√°lisis peritoneal">RRT ‚Äì Di√°lisis peritoneal</option>
          <option value="Heart-Lung / ECMO">Heart‚ÄìLung / ECMO / Otros</option>
        </select>
        <p class="mini">Tip: elige un tema espec√≠fico si quieres repasar solo una parte.</p>
      </div>
      <div>
        <label>Modo</label>
        <div class="row">
          <button class="action primary" id="studyModeBtn">Modo estudio</button>
          <button class="action" id="examModeBtn">Modo examen</button>
        </div>
        <p class="mini">Estudio = feedback inmediato. Examen = solo ves si acertaste.</p>
      </div>
    </div>

    <div style="margin-top: 10px;">
      <div class="stats">
        <div class="stat-pill" id="scoreStat">Puntaje: 0/0</div>
        <div class="stat-pill" id="accuracyStat">Precisi√≥n: 0%</div>
        <div class="stat-pill" id="streakStat">Racha: 0 ‚úîÔ∏è</div>
      </div>
      <div class="progress-bar">
        <div class="progress-inner" id="progressInner"></div>
      </div>
      <p class="mini">Progreso ‚âà preguntas √∫nicas vistas en este tema.</p>
    </div>
  </div>

  <!-- Tarjeta de pregunta -->
  <div class="card" id="questionCard">
    <div class="question-topic" id="questionTopic"></div>
    <div class="question-text" id="questionText"></div>
    <div class="options" id="optionsContainer"></div>
    <div id="feedbackArea"></div>

    <div class="btn-row">
      <button class="action primary" id="checkBtn">Comprobar respuesta</button>
      <button class="action" id="nextBtn" disabled>Siguiente pregunta ‚ûú</button>
      <button class="action" id="resetBtn">Reiniciar stats</button>
    </div>
  </div>

  <div class="card">
    <strong>¬øC√≥mo usar esto r√°pido?</strong>
    <ul style="font-size:0.9rem; color:var(--muted); margin-top:6px; padding-left:18px;">
      <li>1) Elige un tema arriba (por ejemplo ‚ÄúInfusi√≥n‚Äù).</li>
      <li>2) Contesta ~10 preguntas seguidas en ese tema.</li>
      <li>3) Cambia a otro tema (RRT, heart‚Äìlung, etc.).</li>
      <li>4) Cuando ya domines todo, usa ‚ÄúTodos los temas (mixto)‚Äù en modo examen.</li>
    </ul>
  </div>
</div>

<script>
  // =================== BANCO DE PREGUNTAS ===================

  const questions = [
    // ========= ANESTESIA ‚Äì B√ÅSICO =========
    {
      topic: "Anestesia - B√°sico",
      question: "¬øCu√°l es la funci√≥n principal de la m√°quina de anestesia durante un procedimiento quir√∫rgico?",
      options: [
        "Solo monitorear signos vitales",
        "Mezclar gases (O‚ÇÇ, aire, N‚ÇÇO y agente anest√©sico) y facilitar la ventilaci√≥n segura del paciente",
        "Actuar como bomba de circulaci√≥n extracorp√≥rea",
        "Realizar radiograf√≠as intraoperatorias"
      ],
      correctIndex: 1,
      explanation: "La m√°quina de anestesia mezcla O‚ÇÇ, aire, N‚ÇÇO y anest√©sicos vol√°tiles para controlar el estado de consciencia y, con su ventilador, mantiene una ventilaci√≥n controlada y segura."
    },
    {
      topic: "Anestesia - B√°sico",
      question: "¬øCu√°l NO es una de las funciones principales de la m√°quina de anestesia?",
      options: [
        "Proporcionar ox√≠geno al paciente",
        "Mezclar gases y anest√©sico vol√°til",
        "Facilitar ventilaci√≥n mec√°nica",
        "Realizar hemodi√°lisis intermitente"
      ],
      correctIndex: 3,
      explanation: "La hemodi√°lisis es funci√≥n de la m√°quina de hemodi√°lisis; la m√°quina de anestesia se enfoca en mezcla de gases, oxigenaci√≥n y ventilaci√≥n."
    },
    {
      topic: "Anestesia - B√°sico",
      question: "En una m√°quina de anestesia, ¬øqu√© significa FiO‚ÇÇ?",
      options: [
        "Fracci√≥n de ox√≠geno inspirado en el gas que se entrega al paciente",
        "Flujo inicial de ox√≠geno a la m√°quina",
        "Frecuencia inspiratoria del paciente",
        "Fibrilaci√≥n intermitente de ox√≠geno"
      ],
      correctIndex: 0,
      explanation: "FiO‚ÇÇ es la fracci√≥n de ox√≠geno en la mezcla de gas inspirada por el paciente."
    },
    {
      topic: "Anestesia - B√°sico",
      question: "¬øQu√© modo ventilatorio NO es t√≠pico en una m√°quina de anestesia b√°sica?",
      options: [
        "VCV (control por volumen)",
        "PCV (control por presi√≥n)",
        "Manual / espont√°neo",
        "ECMO"
      ],
      correctIndex: 3,
      explanation: "ECMO es un sistema extracorp√≥reo, no un modo de ventilaci√≥n de la m√°quina de anestesia."
    },
    {
      topic: "Anestesia - B√°sico",
      question: "¬øCu√°l es el par√°metro ventilatorio que define el volumen de cada respiraci√≥n?",
      options: [
        "VT (tidal volume)",
        "PEEP",
        "Pmax",
        "EtCO‚ÇÇ"
      ],
      correctIndex: 0,
      explanation: "El volumen corriente o VT es el volumen de gas entregado en cada ciclo respiratorio."
    },

    // ========= ANESTESIA ‚Äì COMPONENTES / SEGURIDAD =========
    {
      topic: "Anestesia - Componentes/Seguridad",
      question: "En la parte de gases, cada cilindro pasa por un regulador que t√≠picamente reduce la presi√≥n a:",
      options: [
        "5 psi",
        "45 psi",
        "150 psi",
        "400 kPa (solo flush)"
      ],
      correctIndex: 1,
      explanation: "Los reguladores de l√≠nea de cilindros reducen la presi√≥n de alta a alrededor de 45 psi para ser manejable por el sistema."
    },
    {
      topic: "Anestesia - Componentes/Seguridad",
      question: "¬øQu√© es el sistema Hypoxic Guard en una m√°quina de anestesia?",
      options: [
        "Un sistema de respaldo de bater√≠a",
        "Un protector contra sobrepresi√≥n en la v√≠a a√©rea",
        "Un sistema que evita que la mezcla administrada tenga menos de 21% de O‚ÇÇ",
        "Un filtro especial para CO‚ÇÇ en el circuito"
      ],
      correctIndex: 2,
      explanation: "El Hypoxic Guard evita mezclas hip√≥xicas, ya sea acoplando mec√°nicamente las v√°lvulas o usando un analizador de O‚ÇÇ con acciones de protecci√≥n."
    },
    {
      topic: "Anestesia - Componentes/Seguridad",
      question: "¬øPor qu√© el flowmeter de O‚ÇÇ suele ir hasta el final de la l√≠nea (m√°s cercano al vaporizador)?",
      options: [
        "Para ahorrar ox√≠geno",
        "Para reducir el riesgo de que una fuga downstream produzca una mezcla hip√≥xica",
        "Porque el O‚ÇÇ es m√°s pesado",
        "Por razones est√©ticas del panel"
      ],
      correctIndex: 1,
      explanation: "Si hubiera una fuga downstream, tener el flowmeter de O‚ÇÇ al final reduce el riesgo de entregar una mezcla con muy poco ox√≠geno."
    },
    {
      topic: "Anestesia - Componentes/Seguridad",
      question: "¬øCu√°l es la funci√≥n del canister con cal sodada (soda lime) en la m√°quina de anestesia?",
      options: [
        "Agregar m√°s O‚ÇÇ al circuito",
        "Absorber CO‚ÇÇ del gas recirculado",
        "Filtrar bacterias y virus",
        "Medir EtCO‚ÇÇ"
      ],
      correctIndex: 1,
      explanation: "El absorbedor con soda lime elimina CO‚ÇÇ del gas recirculado para evitar hipercapnia."
    },
    {
      topic: "Anestesia - Componentes/Seguridad",
      question: "¬øQu√© caracter√≠stica de seguridad tienen los vaporizadores para evitar errores de agente?",
      options: [
        "Todos usan el mismo conector universal",
        "No tienen cerradura",
        "Son espec√≠ficos de agente y tienen c√≥digos de color/llaves especiales",
        "Se llenan por gravedad sin conexi√≥n"
      ],
      correctIndex: 2,
      explanation: "Los vaporizadores son agente‚Äìespec√≠ficos y usan sistemas de llenado propios para evitar poner el agente incorrecto."
    },
    {
      topic: "Anestesia - Componentes/Seguridad",
      question: "¬øQu√© hace la v√°lvula APL (Adjustable Pressure Limiting)?",
      options: [
        "Ajusta la FiO‚ÇÇ",
        "Limita la presi√≥n m√°xima y env√≠a exceso de gas al sistema de escape",
        "Controla la temperatura del gas",
        "Enciende el ventilador"
      ],
      correctIndex: 1,
      explanation: "La APL es una v√°lvula de alivio de presi√≥n ajustable que protege contra sobrepresi√≥n en ventilaci√≥n manual."
    },
    {
      topic: "Anestesia - Componentes/Seguridad",
      question: "El ‚Äòoxygen flush‚Äô entrega:",
      options: [
        "35‚Äì75 L/min de O‚ÇÇ a alta presi√≥n, por eso s√≥lo se usa cuando el paciente NO est√° conectado",
        "0.5 L/min de aire ambiente",
        "N‚ÇÇO puro para inducci√≥n r√°pida",
        "Una mezcla 50/50 N‚ÇÇO/O‚ÇÇ"
      ],
      correctIndex: 0,
      explanation: "El flush de O‚ÇÇ entrega un flujo muy alto de ox√≠geno y puede generar barotrauma si se usa con el paciente conectado."
    },

    // ========= ANESTESIA ‚Äì CONVERSI√ìN A VENTILADOR =========
    {
      topic: "Anestesia - Conversi√≥n a ventilador",
      question: "Antes de convertir un Dr√§ger Primus a ventilador mec√°nico de emergencia, ¬øqu√© debes tener SIEMPRE listo?",
      options: [
        "Una m√°quina de hemodi√°lisis",
        "Un desfibrilador externo autom√°tico",
        "Un dispositivo de ventilaci√≥n manual (resucitador) con filtro HEPA y fuente de O‚ÇÇ",
        "Un marcapasos externo transcut√°neo"
      ],
      correctIndex: 2,
      explanation: "Siempre se requiere respaldo de ventilaci√≥n manual con filtro HEPA en caso de falla del equipo."
    },
    {
      topic: "Anestesia - Conversi√≥n a ventilador",
      question: "Durante la conversi√≥n de una m√°quina de anestesia a ventilador, ¬øqu√© se recomienda hacer con el N‚ÇÇO?",
      options: [
        "Conectarlo como gas principal",
        "Desconectar mangueras y cilindros de N‚ÇÇO para no usarlo",
        "Aumentar su concentraci√≥n para sedaci√≥n",
        "No importa, se puede dejar conectado"
      ],
      correctIndex: 1,
      explanation: "En conversi√≥n a ventilador de emergencia se recomienda NO usar N‚ÇÇO: se desconectan mangueras y cilindros."
    },
    {
      topic: "Anestesia - Conversi√≥n a ventilador",
      question: "Al preparar un Primus / Carestation para ventilaci√≥n prolongada, respecto a los vaporizadores se debe:",
      options: [
        "Dejarlos encendidos al 1%",
        "Quitarlos o apagarlos y purgar con O‚ÇÇ",
        "Cambiar el anest√©sico a desflurano",
        "No realizar ninguna acci√≥n"
      ],
      correctIndex: 1,
      explanation: "Se deben apagar o retirar los vaporizadores y purgar la l√≠nea con O‚ÇÇ para evitar exposici√≥n innecesaria a anest√©sico."
    },
    {
      topic: "Anestesia - Conversi√≥n a ventilador",
      question: "En la gu√≠a de GE Carestation 650 Plus, ¬øcada cu√°nto se requiere el self-test autom√°tico que impide ventilar durante su ejecuci√≥n?",
      options: [
        "Cada 72 horas",
        "Cada 24 horas",
        "Cada 12 horas",
        "Una vez a la semana"
      ],
      correctIndex: 2,
      explanation: "El self-test autom√°tico est√° programado t√≠picamente cada 12 horas; durante este tiempo la m√°quina no ventila, y se debe asegurar ventilaci√≥n alternativa."
    },
    {
      topic: "Anestesia - Conversi√≥n a ventilador",
      question: "En la conversi√≥n descrita, la v√°lvula APL al final debe colocarse en:",
      options: [
        "MAN a 30 mbar y dejarla as√≠",
        "0 cmH‚ÇÇO y modo VENT en el selector Bag/Vent",
        "Valor m√°ximo para evitar fugas",
        "No se usa la APL en conversi√≥n"
      ],
      correctIndex: 1,
      explanation: "Tras la prueba, la APL se deja en 0 cmH‚ÇÇO y el selector en VENT para ventilaci√≥n mec√°nica."
    },

    // ========= INFUSI√ìN =========
    {
      topic: "Infusi√≥n",
      question: "La infusi√≥n intravenosa se define como:",
      options: [
        "Administraci√≥n de medicamentos por v√≠a oral",
        "Entrega de medicamento, nutrici√≥n o l√≠quidos directamente en la vena para acceso r√°pido al torrente sangu√≠neo",
        "Solo transfusi√≥n de sangre",
        "Aplicaci√≥n t√≥pica de f√°rmacos"
      ],
      correctIndex: 1,
      explanation: "La definici√≥n cl√°sica incluye medicamentos, nutrientes o soluciones administrados directamente al sistema venoso para absorci√≥n r√°pida."
    },
    {
      topic: "Infusi√≥n",
      question: "¬øCu√°l de los siguientes NO es un tipo de dispositivo de infusi√≥n mencionado?",
      options: [
        "Bomba elastom√©rica",
        "Controlador de infusi√≥n (drip controller)",
        "Volumetric pump",
        "Resonador magn√©tico de infusi√≥n"
      ],
      correctIndex: 3,
      explanation: "El resonador magn√©tico de infusi√≥n no existe como dispositivo; los dem√°s s√≠ son dispositivos de infusi√≥n reales."
    },
    {
      topic: "Infusi√≥n",
      question: "Una bomba volum√©trica de infusi√≥n genera flujo por:",
      options: [
        "Gravedad √∫nicamente",
        "Presi√≥n positiva mediante mecanismo interno (pist√≥n, diafragma o perist√°ltico)",
        "Evaporaci√≥n del l√≠quido",
        "Acci√≥n capilar de la manguera"
      ],
      correctIndex: 1,
      explanation: "Las bombas volum√©tricas generan presi√≥n positiva mediante un mecanismo mec√°nico, controlando con precisi√≥n el flujo."
    },
    {
      topic: "Infusi√≥n",
      question: "¬øQu√© mecanismo corresponde a una bomba lineal perist√°ltica?",
      options: [
        "Un solo pist√≥n que empuja una jeringa",
        "Serie de varillas (rods) que presionan secuencialmente la l√≠nea de infusi√≥n",
        "Un diafragma que vibra",
        "Una bomba centr√≠fuga"
      ],
      correctIndex: 1,
      explanation: "La bomba lineal perist√°ltica usa varias varillas que comprimen la l√≠nea en secuencia, logrando un flujo muy preciso."
    },
    {
      topic: "Infusi√≥n",
      question: "En una bomba volum√©trica, ¬øqu√© significa VTBI?",
      options: [
        "Very tiny blood index",
        "Voltage to be infused",
        "Volume To Be Infused",
        "Ventilation Time Between Infusions"
      ],
      correctIndex: 2,
      explanation: "VTBI es el volumen total programado que se debe infundir en una terapia."
    },
    {
      topic: "Infusi√≥n",
      question: "¬øCu√°l es una alarma t√≠pica en bombas de infusi√≥n?",
      options: [
        "Fiebre del paciente",
        "Bater√≠a baja, oclusi√≥n en la l√≠nea, aire en l√≠nea y Near End Of Infusion (NEOI)",
        "Hipertensi√≥n arterial",
        "Bradicardia sinusal"
      ],
      correctIndex: 1,
      explanation: "Las bombas incluyen alarmas de oclusi√≥n, aire en l√≠nea, fin de infusi√≥n y bater√≠a baja, entre otras."
    },
    {
      topic: "Infusi√≥n",
      question: "¬øQu√© afirmaci√≥n es correcta sobre las bombas de jeringa (syringe infuser)?",
      options: [
        "Usan rodillos externos para mover el fluido",
        "Mueven un tornillo con paso definido que empuja el √©mbolo de la jeringa",
        "Solo funcionan con jeringas de 5 ml",
        "No permiten flujos bajos (<1 mL/h)"
      ],
      correctIndex: 1,
      explanation: "Un motor mueve un tornillo con un paso determinado; este tornillo empuja el √©mbolo, permitiendo flujos muy bajos y precisos."
    },

    // ========= RRT / HEMODI√ÅLISIS / CRRT =========
    {
      topic: "RRT/Hemodi√°lisis",
      question: "La Terapia de Reemplazo Renal (RRT) se define como:",
      options: [
        "Proceso que reemplaza completamente todas las funciones endocrinas del ri√±√≥n",
        "Proceso artificial que reemplaza parcialmente la funci√≥n renal, especialmente la filtraci√≥n",
        "Solo transfusi√≥n de sangre",
        "√önicamente administraci√≥n de diur√©ticos"
      ],
      correctIndex: 1,
      explanation: "La RRT reemplaza parcialmente funciones renales, sobre todo filtraci√≥n y eliminaci√≥n de solutos y agua."
    },
    {
      topic: "RRT/Hemodi√°lisis",
      question: "En hemodi√°lisis, el dializador (filtro) permite el paso de:",
      options: [
        "Agua y solutos peque√±os/medianos, pero no c√©lulas sangu√≠neas ni prote√≠nas grandes",
        "Solo gl√≥bulos rojos",
        "Solo prote√≠nas plasm√°ticas",
        "Todos los componentes de la sangre sin selectividad"
      ],
      correctIndex: 0,
      explanation: "La membrana semipermeable permite paso de agua y solutos de bajo y mediano peso molecular, pero retiene c√©lulas y prote√≠nas grandes."
    },
    {
      topic: "RRT/Hemodi√°lisis",
      question: "¬øQu√© mecanismo de transporte domina la eliminaci√≥n de solutos peque√±os (<500 Da) en hemodi√°lisis convencional?",
      options: [
        "Difusi√≥n",
        "Ultrafiltraci√≥n (convecci√≥n) exclusivamente",
        "Adsorci√≥n",
        "Osmosis inversa"
      ],
      correctIndex: 0,
      explanation: "La difusi√≥n a trav√©s del gradiente de concentraci√≥n entre sangre y dialisato es el mecanismo principal para solutos peque√±os."
    },
    {
      topic: "RRT/Hemodi√°lisis",
      question: "La ultrafiltraci√≥n (en este contexto) se refiere principalmente a:",
      options: [
        "Transporte de solvente y solutos por un gradiente de presi√≥n (convecci√≥n)",
        "Difusi√≥n simple por gradiente de concentraci√≥n",
        "Solo adsorci√≥n sobre la membrana",
        "Evaporaci√≥n del dialisato"
      ],
      correctIndex: 0,
      explanation: "La ultrafiltraci√≥n es un proceso convectivo: arrastra solvente y solutos a trav√©s de la membrana impulsados por la presi√≥n transmembrana."
    },
    {
      topic: "RRT/Hemodi√°lisis",
      question: "En RRT, ¬øqu√© t√©cnica est√° pensada para uso continuo en UCI con flujo lento y membranas m√°s porosas?",
      options: [
        "IHD (hemodi√°lisis intermitente)",
        "CRRT (Continuous Renal Replacement Therapy)",
        "Peritoneal dialysis manual",
        "SLED √∫nicamente"
      ],
      correctIndex: 1,
      explanation: "CRRT se usa de forma continua, con flujos m√°s bajos y membranas m√°s porosas, mejor tolerada hemodin√°micamente."
    },
    {
      topic: "RRT/Hemodi√°lisis",
      question: "En CRRT, la modalidad SCUF (Slow Continuous Ultrafiltration) tiene como objetivo principal:",
      options: [
        "Eliminar solutos por difusi√≥n intensiva",
        "Controlar √∫nicamente el volumen (remoci√≥n de l√≠quido) con poca o nula depuraci√≥n de solutos",
        "Reemplazar funci√≥n endocrina del ri√±√≥n",
        "Administrar nutrici√≥n parenteral"
      ],
      correctIndex: 1,
      explanation: "SCUF se centra en la remoci√≥n de l√≠quido para pacientes con sobrecarga de volumen, sin un alto foco en la depuraci√≥n de solutos."
    },
    {
      topic: "RRT/Hemodi√°lisis",
      question: "¬øQu√© modalidad de CRRT combina difusi√≥n y convecci√≥n?",
      options: [
        "SCUF",
        "CVVH",
        "CVVHD",
        "CVVHDF"
      ],
      correctIndex: 3,
      explanation: "CVVHDF (hemodiafiltraci√≥n venovenosa continua) combina hemodi√°lisis (difusi√≥n) y hemofiltraci√≥n (convecci√≥n)."
    },
    {
      topic: "RRT/Hemodi√°lisis",
      question: "¬øCu√°l de los siguientes accesos es t√≠pico para hemodi√°lisis cr√≥nica en brazo?",
      options: [
        "F√≠stula arteriovenosa (arteria radial ‚Äì vena cef√°lica)",
        "Cat√©ter venoso femoral temporal",
        "Cat√©ter central subclavio de corta duraci√≥n",
        "Cat√©ter intratecal"
      ],
      correctIndex: 0,
      explanation: "La f√≠stula AV radial‚Äìcef√°lica es un acceso cl√°sico y duradero para hemodi√°lisis cr√≥nica."
    },

    // ========= RRT ‚Äì DI√ÅLISIS PERITONEAL =========
    {
      topic: "RRT - Di√°lisis peritoneal",
      question: "En la di√°lisis peritoneal, la membrana de intercambio es:",
      options: [
        "La membrana de un dializador externo",
        "La piel del paciente",
        "El peritoneo del paciente",
        "Una membrana de celulosa artificial"
      ],
      correctIndex: 2,
      explanation: "En di√°lisis peritoneal, la cavidad peritoneal y su membrana act√∫an como filtro biol√≥gico."
    },
    {
      topic: "RRT - Di√°lisis peritoneal",
      question: "¬øCu√°l es una desventaja importante de la di√°lisis peritoneal?",
      options: [
        "No se puede realizar en UCI",
        "Riesgo de peritonitis si no se cuida bien el cat√©ter",
        "No requiere monitoreo de volumen",
        "No se puede usar en pacientes diab√©ticos"
      ],
      correctIndex: 1,
      explanation: "La peritonitis es una complicaci√≥n grave si no se cuida adecuadamente el sitio del cat√©ter."
    },
    {
      topic: "RRT - Di√°lisis peritoneal",
      question: "La di√°lisis peritoneal automatizada es, en comparaci√≥n con hemodi√°lisis, generalmente:",
      options: [
        "M√°s r√°pida pero peor tolerada",
        "M√°s lenta y se asemeja m√°s a la fisiolog√≠a normal de los ri√±ones",
        "Igual de r√°pida que la hemodi√°lisis de alto flujo",
        "Incompatible con pacientes en UCI"
      ],
      correctIndex: 1,
      explanation: "La di√°lisis peritoneal es m√°s lenta y continua, asemej√°ndose m√°s al funcionamiento fisiol√≥gico renal."
    },

    // ========= HEART‚ÄìLUNG, ECMO Y OTROS =========
    {
      topic: "Heart-Lung / ECMO",
      question: "La heart‚Äìlung machine (m√°quina coraz√≥n‚Äìpulm√≥n) se utiliza principalmente para:",
      options: [
        "Control de presi√≥n arterial en UCI",
        "Sustituir temporalmente la funci√≥n cardiaca y pulmonar durante cirug√≠a cardiaca",
        "Filtrar la sangre en hemodi√°lisis",
        "Administrar nutrici√≥n parenteral"
      ],
      correctIndex: 1,
      explanation: "Durante bypass cardiopulmonar, la m√°quina coraz√≥n‚Äìpulm√≥n asume la circulaci√≥n y la oxigenaci√≥n mientras el coraz√≥n est√° detenido."
    },
    {
      topic: "Heart-Lung / ECMO",
      question: "En la heart‚Äìlung machine, el sistema debe proporcionar:",
      options: [
        "Volumen de perfusi√≥n suficiente, presi√≥n adecuada (50‚Äì90 mmHg), oxigenaci√≥n y control de temperatura",
        "Solo oxigenaci√≥n sin control de presi√≥n",
        "Solo control de temperatura",
        "√önicamente succi√≥n cardiaca"
      ],
      correctIndex: 0,
      explanation: "Debe reproducir un gasto card√≠aco adecuado, mantener presi√≥n de perfusi√≥n, oxigenar, remover CO‚ÇÇ y controlar temperatura."
    },
    {
      topic: "Heart-Lung / ECMO",
      question: "¬øCu√°l es una desventaja clave de las bombas de rodillos (roller) en la m√°quina coraz√≥n‚Äìpulm√≥n?",
      options: [
        "Son muy baratas",
        "No pueden generar presi√≥n suficiente",
        "Pueden producir hem√≥lisis y spallation si la oclusi√≥n es incorrecta",
        "No permiten flujo puls√°til"
      ],
      correctIndex: 2,
      explanation: "La oclusi√≥n excesiva causa hem√≥lisis y microfragmentaci√≥n de la manguera (spallation); la oclusi√≥n insuficiente provoca turbulencia y da√±o celular."
    },
    {
      topic: "Heart-Lung / ECMO",
      question: "Una bomba centr√≠fuga en circulaci√≥n extracorp√≥rea se caracteriza por:",
      options: [
        "Ser oclusiva y bombear contra cualquier resistencia",
        "Ser no oclusiva y dependiente de pre y poscarga",
        "No necesitar energ√≠a",
        "No producir nunca calor ni trombos"
      ],
      correctIndex: 1,
      explanation: "La bomba centr√≠fuga es no oclusiva y el flujo depende de la presi√≥n de entrada y salida; es menos propensa a disecciones de vaso pero m√°s compleja."
    },
    {
      topic: "Heart-Lung / ECMO",
      question: "ECMO (Extracorporeal Membrane Oxygenation) se diferencia de la bypass machine cl√°sica porque:",
      options: [
        "Solo se usa para minutos",
        "Est√° dise√±ado para soporte prolongado en falla cardiaca o respiratoria grave",
        "No oxigena la sangre",
        "No utiliza bomba"
      ],
      correctIndex: 1,
      explanation: "ECMO se usa por per√≠odos prolongados en UCI para soporte cardiopulmonar, mientras que el bypass tradicional se usa durante una cirug√≠a."
    },
    {
      topic: "Heart-Lung / ECMO",
      question: "¬øCu√°l es la funci√≥n principal de un Ventricular Assist Device (VAD)?",
      options: [
        "Producir corriente el√©ctrica para marcapasos",
        "Asistir parcialmente la funci√≥n de bombeo del coraz√≥n (LVAD o RVAD)",
        "Reemplazar los ri√±ones",
        "Oxigenar la sangre fuera del cuerpo"
      ],
      correctIndex: 1,
      explanation: "Los VAD asisten al ventr√≠culo izquierdo o derecho, ayudando a eyectar sangre al sistema circulatorio."
    },
    {
      topic: "Heart-Lung / ECMO",
      question: "El IABP (Intra-Aortic Balloon Pump) mejora el gasto cardiaco principalmente al:",
      options: [
        "Incrementar la frecuencia cardiaca",
        "Inflarse en s√≠stole para aumentar la poscarga",
        "Inflarse en di√°stole para aumentar perfusi√≥n coronaria y disminuir poscarga en s√≠stole",
        "Filtrar la sangre de toxinas"
      ],
      correctIndex: 2,
      explanation: "El bal√≥n se infla en di√°stole (aumenta perfusi√≥n coronaria) y se desinfla antes de la s√≠stole, reduciendo la poscarga."
    }
  ];

  // =================== L√ìGICA DEL JUEGO ===================

  const topicSelect = document.getElementById("topicSelect");
  const questionTopicEl = document.getElementById("questionTopic");
  const questionTextEl = document.getElementById("questionText");
  const optionsContainer = document.getElementById("optionsContainer");
  const feedbackArea = document.getElementById("feedbackArea");

  const scoreStat = document.getElementById("scoreStat");
  const accuracyStat = document.getElementById("accuracyStat");
  const streakStat = document.getElementById("streakStat");
  const progressInner = document.getElementById("progressInner");

  const checkBtn = document.getElementById("checkBtn");
  const nextBtn = document.getElementById("nextBtn");
  const resetBtn = document.getElementById("resetBtn");
  const studyModeBtn = document.getElementById("studyModeBtn");
  const examModeBtn = document.getElementById("examModeBtn");

  let currentQuestion = null;
  let currentIndex = -1;
  let selectedIndex = null;
  let answered = 0;
  let correct = 0;
  let streak = 0;
  let mode = "study"; // "study" or "exam"
  let seenQuestions = new Set(); // para progreso por tema

  function getFilteredQuestions() {
    const topic = topicSelect.value;
    if (topic === "todos") return questions;
    return questions.filter(q => q.topic === topic);
  }

  function pickNewQuestion() {
    const pool = getFilteredQuestions();
    if (pool.length === 0) return;

    let idx;
    // intentar no repetir tanto dentro del mismo tema
    const poolIndices = pool.map((_, i) => i);
    const maxTries = 20;
    let tries = 0;
    do {
      idx = Math.floor(Math.random() * pool.length);
      tries++;
    } while (seenQuestions.has(topicSelect.value + "-" + idx) && tries < maxTries);

    currentQuestion = pool[idx];
    currentIndex = idx;
    selectedIndex = null;
    renderQuestion();
  }

  function renderQuestion() {
    // T√≠tulo de tema + texto
    questionTopicEl.textContent = currentQuestion.topic;
    questionTextEl.textContent = currentQuestion.question;

    // Opciones
    optionsContainer.innerHTML = "";
    currentQuestion.options.forEach((opt, i) => {
      const btn = document.createElement("button");
      btn.className = "option-btn";
      btn.textContent = (i + 1) + ") " + opt;
      btn.addEventListener("click", () => selectOption(i));
      optionsContainer.appendChild(btn);
    });

    feedbackArea.innerHTML = "";
    checkBtn.disabled = false;
    nextBtn.disabled = true;
  }

  function selectOption(i) {
    selectedIndex = i;
    const buttons = optionsContainer.querySelectorAll(".option-btn");
    buttons.forEach((btn, idx) => {
      btn.classList.toggle("selected", idx === i);
      btn.classList.remove("correct", "incorrect");
    });
    feedbackArea.innerHTML = "";
  }

  function checkAnswer() {
    if (selectedIndex === null) {
      feedbackArea.innerHTML = "<div class='feedback incorrect'>Elige primero una opci√≥n üìå</div>";
      return;
    }

    const buttons = optionsContainer.querySelectorAll(".option-btn");
    buttons.forEach((btn, idx) => {
      btn.classList.remove("selected");
      if (idx === currentQuestion.correctIndex) {
        btn.classList.add("correct");
      } else if (idx === selectedIndex && idx !== currentQuestion.correctIndex) {
        btn.classList.add("incorrect");
      }
    });

    const isCorrect = selectedIndex === currentQuestion.correctIndex;
    answered++;
    if (isCorrect) {
      correct++;
      streak++;
    } else {
      streak = 0;
    }
    seenQuestions.add(topicSelect.value + "-" + currentIndex);

    updateStats();

    let fbClass = isCorrect ? "feedback correct" : "feedback incorrect";
    let emoji = isCorrect ? "‚úÖ" : "‚ùå";
    let textIntro = isCorrect
      ? "¬°Bien! Respuesta correcta."
      : `Respuesta incorrecta. La opci√≥n correcta es: ${(currentQuestion.correctIndex + 1)}.`;

    const explanationHtml =
      `<div class="${fbClass}">
        <strong>${emoji} ${textIntro}</strong><br>
        ${mode === "study" ? currentQuestion.explanation : "Modo examen: revisa la explicaci√≥n en tus notas o cambia a modo estudio para ver m√°s detalle."}
       </div>`;
    feedbackArea.innerHTML = explanationHtml;

    checkBtn.disabled = true;
    nextBtn.disabled = false;
  }

  function updateStats() {
    scoreStat.textContent = `Puntaje: ${correct}/${answered}`;
    const acc = answered > 0 ? Math.round((correct / answered) * 100) : 0;
    accuracyStat.textContent = `Precisi√≥n: ${acc}%`;
    streakStat.textContent = `Racha: ${streak} ‚úîÔ∏è`;

    // progreso = proporci√≥n de preguntas √∫nicas vistas en este tema
    const pool = getFilteredQuestions();
    let countSeen = 0;
    pool.forEach((_, i) => {
      if (seenQuestions.has(topicSelect.value + "-" + i)) countSeen++;
    });
    const progress = pool.length > 0 ? (countSeen / pool.length) * 100 : 0;
    progressInner.style.width = progress + "%";
  }

  function nextQuestion() {
    pickNewQuestion();
  }

  function resetStats() {
    answered = 0;
    correct = 0;
    streak = 0;
    seenQuestions.clear();
    updateStats();
    pickNewQuestion();
  }

  function setMode(newMode) {
    mode = newMode;
    if (mode === "study") {
      studyModeBtn.classList.add("primary");
      examModeBtn.classList.remove("primary");
    } else {
      examModeBtn.classList.add("primary");
      studyModeBtn.classList.remove("primary");
    }
  }

  // Event listeners
  checkBtn.addEventListener("click", checkAnswer);
  nextBtn.addEventListener("click", nextQuestion);
  resetBtn.addEventListener("click", resetStats);

  topicSelect.addEventListener("change", () => {
    // al cambiar de tema no borro stats globales, solo el progreso de ese tema se recalcula
    pickNewQuestion();
    updateStats();
  });

  studyModeBtn.addEventListener("click", () => setMode("study"));
  examModeBtn.addEventListener("click", () => setMode("exam"));

  // Inicializar
  setMode("study");
  pickNewQuestion();
  updateStats();
</script>
</body>
</html>
